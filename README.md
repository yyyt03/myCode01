# 基于STM32的智能光控窗帘系统

## 项目概述

本项目是一款基于STM32F103微控制器的智能窗帘控制系统，能够根据环境光照强度自动调节窗帘开合角度，同时支持手动调节和远程控制。系统通过ESP8266 WiFi模块接入OneNET物联网平台，实现数据上云和远程监控功能。

## 系统特点

- **双模式运行**：支持光照强度自动控制和手动调节两种模式
- **智能光照映射**：根据不同光照强度自动调整窗帘角度，实现舒适光环境
- **物联网连接**：通过ESP8266连接OneNET平台，实现数据上传和远程控制
- **NTP时间同步**：自动与网络时间服务器同步，确保准确时间显示
- **直观界面**：0.96寸OLED显示屏实时展示系统状态、光照强度和窗帘角度

## 硬件组成

- **控制核心**：STM32F103C8T6微控制器
- **光照传感**：BH1750FVI高精度数字光照传感器
- **执行机构**：SG90舵机（PWM控制，角度0-180°）
- **网络模块**：ESP8266 WiFi模块
- **显示单元**：0.96寸OLED显示屏（I2C接口）
- **控制输入**：独立按键（模式切换和角度调整）

## 光照映射算法

系统根据光照强度自动将窗帘调整到最佳角度：

| 光照范围 (lux) | 窗帘角度 | 效果描述                   |
| -------------- | -------- | -------------------------- |
| < 50           | 0°       | 完全闭合（保护隐私）       |
| 50-100         | 30°      | 小角度开启（适合较暗环境） |
| 100-200        | 90°      | 中等开启（一般室内照明）   |
| 200-500        | 150°     | 大角度开启（明亮环境）     |
| > 500          | 180°     | 完全展开（强光环境）       |

## 工作流程

1. **系统初始化**：硬件外设初始化、WiFi连接和OneNET平台接入
2. **数据采集**：每500ms采集一次光照强度
3. **角度计算**：根据当前模式和光照值计算目标角度
4. **执行控制**：通过PWM信号控制舵机旋转至目标角度
5. **数据上传**：每5秒将光照强度和窗帘角度上传至OneNET平台
6. **远程控制**：接收并处理OneNET平台下发的控制指令

该系统通过STM32灵活的外设控制能力和WiFi联网功能，实现了智能家居中的一个重要应用场景，为用户提供更加舒适、节能的室内光环境。